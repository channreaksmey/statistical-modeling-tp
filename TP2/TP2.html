<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>TP2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="TP2_files/libs/clipboard/clipboard.min.js"></script>
<script src="TP2_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="TP2_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="TP2_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="TP2_files/libs/quarto-html/popper.min.js"></script>
<script src="TP2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TP2_files/libs/quarto-html/anchor.min.js"></script>
<link href="TP2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TP2_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TP2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TP2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TP2_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TP2</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="tp2---simple-linear-regression" class="level1">
<h1>TP2 - Simple Linear Regression</h1>
<section id="problem-1" class="level2">
<h2 class="anchored" data-anchor-id="problem-1">Problem 1</h2>
<p>Height and weight data (Data file: Htwt) The table below and the the data file give ht = height in centimeters and wt = weight in kilograms for a sample of n = 10 18-year-old girls. The interest is in predicting weight from height.</p>
<p>a. Drawv a scatterplot of <span class="math inline">\(wt\)</span> on the vertical axis versus <span class="math inline">\(ht\)</span> on the horizontal axis. On the basis of the plot, does a simple linear model make sense for these data? Why or why not?</p>
<p>b. Compute estimates of the slope and the intercept for the regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span>. Draw the fitted line on your scatterplot.</p>
<p>c. Interpret the parameter estimates <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span>. Obtain the <span class="math inline">\(t\)</span>-tests for the hypotheses that <span class="math inline">\(\beta_0=0\)</span> and <span class="math inline">\(\beta_1=0\)</span> and <span class="math inline">\(p\)</span>-values using two-sided tests. what is your conclusion based on the <span class="math inline">\(p\)</span>-values.</p>
<p>d. Obtain <span class="math inline">\(R^2\)</span> and adjusted <span class="math inline">\(R^2\)</span>. What can you say about them?</p>
<p>e. Check all the model assumptions for this simple linear regression.</p>
</section>
<section id="problem-2" class="level2">
<h2 class="anchored" data-anchor-id="problem-2">Problem 2</h2>
<p>(Data file: ) The international bank UBS regularly produces a report (UBS, 2009) on prices and earnings in major cities throughtout the world. Three of the measures they include are prices of basic commodities, namely 1kg of rice, 1kg loaf of bread, and the price of a Big Mac Hamburger at McDonalds. An interesting feature of the prices they report is that prices are measured in the minuted of labor required for a “typical” worker in that location ti earn enough money to purchase the commodity. Using minutes of labor corrects at least in part for currency fluctuations, prevailing wage rates, and local prices. The data file includes measurements for rice, bread, and Big Mac prices from the 2003 and the 2009 reports. The year 2003 was before the major recession hit much of the world around 2006, and the year 2009 may reflect changed in prices due to the recession. The figure below is the plot of y = <code>rice2009</code>{=} versus x = , the price of rice in 2009 and 2003, respectively, with the cities corresponding to a few of the points marked.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(alr4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: car</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: effects</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>lattice theme set by effectsTheme()
See ?effectsTheme for details.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"UBSprices"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>UBSprices<span class="sc">$</span>rice2003, <span class="at">y=</span>UBSprices<span class="sc">$</span>rice2009,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"2003 Rice price"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"2009 Rice price"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#identify(x=UBSprices$rice2003, y=UBSprices$rice2009,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#         labels=row.names(UBSprices), n=5)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(rice2009<span class="sc">~</span>rice2003, <span class="at">data=</span>UBSprices), <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"ols"</span>, <span class="st">"y=x"</span>), <span class="at">lty=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.6</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>UBSprices<span class="sc">$</span>rice2003, <span class="at">y=</span>UBSprices<span class="sc">$</span>rice2009,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"2003 Rice price"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"2009 Rice price"</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span>UBSprices<span class="sc">$</span>rice2003, <span class="at">y=</span>UBSprices<span class="sc">$</span>rice2009,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels=</span><span class="fu">row.names</span>(UBSprices), <span class="at">cex=</span><span class="fl">0.6</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(rice2009<span class="sc">~</span>rice2003, <span class="at">data=</span>UBSprices), <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"ols"</span>, <span class="st">"y=x"</span>), <span class="at">lty=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.6</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="a.-the-line-with-equation-yx-is-shown-on-this-plot-as-the-solid-line.-what-is-the-key-difference-between-points-above-this-line-and-points-below-the-line" class="level4">
<h4 class="anchored" data-anchor-id="a.-the-line-with-equation-yx-is-shown-on-this-plot-as-the-solid-line.-what-is-the-key-difference-between-points-above-this-line-and-points-below-the-line">a. The line with equation <span class="math inline">\(y=x\)</span> is shown on this plot as the solid line. What is the key difference between points above this line and points below the line?</h4>
<p>The solid line <span class="math inline">\(y=x\)</span> represents no change in rice prices between 2003 and 2009.</p>
<ul>
<li><p>Points above the line (<span class="math inline">\(y&gt;x\)</span>): Cities where rice prices increased from 2003 to 2009. The rice price in 2009 is higher than it was in 2003.</p></li>
<li><p>Points below the line (<span class="math inline">\(y&lt;x\)</span>): Cities where rice prices decreased from 2003 to 2009. The rice price in 2009 is lower than it was in 2003.</p></li>
<li><p>Points on the line: Cities where rice prices remained the same (no change).</p></li>
</ul>
</section>
<section id="b.-which-city-had-the-largest-increase-in-rice-price-which-had-the-largest-decrease-in-rice-price" class="level4">
<h4 class="anchored" data-anchor-id="b.-which-city-had-the-largest-increase-in-rice-price-which-had-the-largest-decrease-in-rice-price">b. Which city had the largest increase in rice price? Which had the largest decrease in rice price?</h4>
<p>Largest increases in rice prices:</p>
<ul>
<li>Vilnius appears to have the largest increase. It had a relatively low price in 2003 (around 10-15 minutes) but a very high price in 2009 (around 75 minutes).</li>
</ul>
<p>Largest decrease in rice price:</p>
<ul>
<li><p>Nairobi appears to have the largest decrease. It had a relatively high price in 2003 (around 70 minutes) but dropped to around 50 minutes in 2009.</p></li>
<li><p>Alternatively, Mumbai also shows a notable decrease, going from around 85 minutes in 2003 to around 35 minutes in 2009 (though this seems extreme and might warrant data verification).</p></li>
</ul>
</section>
<section id="c.-the-ols-line-hatyhatbeta_0hatbeta_1x-is-shown-on-the-figure-as-a-dashed-line-and-evidently-hatbeta_11.-does-this-suggest-that-prices-are-lower-in-2009-than-in-2003-explain-your-answer." class="level4">
<h4 class="anchored" data-anchor-id="c.-the-ols-line-hatyhatbeta_0hatbeta_1x-is-shown-on-the-figure-as-a-dashed-line-and-evidently-hatbeta_11.-does-this-suggest-that-prices-are-lower-in-2009-than-in-2003-explain-your-answer.">c.&nbsp;The ols line <span class="math inline">\(\hat{y}=\hat{\beta}_0+\hat{\beta}_1x\)</span> is shown on the figure as a dashed line, and evidently <span class="math inline">\(\hat{\beta}_1&lt;1\)</span>. Does this suggest that prices are lower in 2009 than in 2003? Explain your answer.</h4>
<p>No, <span class="math inline">\(\hat{\beta_1}&lt;1\)</span> does not necessarily mean that prices are lower in 2009 than in 2003.</p>
<p>The OLS line is: <span class="math inline">\(\hat{y}=\hat{\beta}_0+\hat{\beta}_1x\)</span></p>
<ul>
<li>If <span class="math inline">\(\hat{\beta}_1&lt;1\)</span>, this means that for every 1 minute increase in 2003 rice price, the 2009 rice price increase by less than 1 minute (on average).</li>
<li>This indicates convergence or “regression to the mean”: cities with very high prices in 2003 tend to have somewhat lower relative increases (or even decreases) by 2009, while cities with low prices in 2003 might have proportionally larger increases.</li>
<li>Whether prices are higher or lower in 2009 depends on both <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span>, not just <span class="math inline">\(\hat{\beta}_1\)</span> alone.</li>
</ul>
<p>For example, if <span class="math inline">\(\hat{\beta}_0=5\)</span> and <span class="math inline">\(\hat{\beta}_1=0.8\)</span>:</p>
<ul>
<li><p>A city with <span class="math inline">\(x=10\)</span> in 2003 would have <span class="math inline">\(\hat{y}=5+0.8(10)=13\)</span> in 2009 (increase)</p></li>
<li><p>A city with <span class="math inline">\(x=20\)</span> in 2003 would have <span class="math inline">\(\hat{y}=5+0.8(20)=21\)</span> in 2009 (increase)</p></li>
</ul>
<p>The intercept <span class="math inline">\(\hat{\beta_0}&lt;0\)</span> suggest that even cities with zero 2003 prices would have positive 2009 prices, indicating an overall upward shift. Looking at the graph, most points are indeed above the lower-left origin area, suggesting general price increases despite <span class="math inline">\(\hat{\beta_1}&lt;1\)</span>.</p>
</section>
<section id="d.-give-two-reasons-why-fitting-simple-linear-regression-to-the-figure-in-this-problem-is-not-likely-to-be-appropriate." class="level4">
<h4 class="anchored" data-anchor-id="d.-give-two-reasons-why-fitting-simple-linear-regression-to-the-figure-in-this-problem-is-not-likely-to-be-appropriate.">d.&nbsp;Give two reasons why fitting simple linear regression to the figure in this problem is not likely to be appropriate.</h4>
<ol type="1">
<li><strong>Heteroscedasticity (Non-constant variance):</strong>
<ul>
<li><p>The scatter of points clearly increases as x increases. Cities with low 2003 prices (left side of plot) show relatively tight clustering, while cities with high 2003 prices (right side) show much greater variability in their 2009 prices.</p></li>
<li><p>This violates the constant variance assumption of linear regression, making standard errors and confidence intervals unreliable.</p></li>
<li><p>The points appear to fan out as you move from left to right.</p></li>
</ul></li>
<li><strong>Non-linear relationship / Outliers:</strong>
<ul>
<li><p>The relationship doesn’t appear strictly linear. There are several <strong>influential outliers</strong> (like Vilnius at top left and possibly Nairobi/Mumbai at the right) that may be unduly influencing the fitted line.</p></li>
<li><p>The curvature in the relationship is suggested by how the points cluster: there’s a dense cluster at the lower left, and the points don’t follow a consistent linear pattern throughout.</p></li>
<li><p><strong>Alternatively</strong>: The data shows a multiplicative rather than additive relationship (prices tend to change proportionally), which suggests a <strong>log transformation</strong> would be more appropriate (as explored in your first question).</p></li>
</ul></li>
</ol>
<p><strong>Additional consideration</strong>: The presence of such extreme outliers (Vilnius, Nairobi, Mumbai) suggests that a few cities experienced very unusual economic conditions that may not be well-captured by a simple linear model fit to all cities together.</p>
</section>
</section>
<section id="problem-3" class="level2">
<h2 class="anchored" data-anchor-id="problem-3">Problem 3</h2>
<p>(Data file: ) This is a continuation of Problem 2. An alternative representation of the data used in the last problem is to use log scales, as in the following figure:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="fu">log</span>(UBSprices<span class="sc">$</span>rice2003), <span class="at">y=</span><span class="fu">log</span>(UBSprices<span class="sc">$</span>rice2009),</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"log(2003 Rice price)"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"log(2009 Rice price)"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(<span class="fu">log</span>(rice2009)<span class="sc">~</span><span class="fu">log</span>(rice2003), <span class="at">data=</span>UBSprices), <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"ols"</span>, <span class="st">"y=x"</span>), <span class="at">lty=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.6</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="a.-explain-why-this-graph-and-the-graph-in-problem-2-suggests-that-using-log-scale-is-preferable-if-fitting-simple-linear-regression-is-desired." class="level4">
<h4 class="anchored" data-anchor-id="a.-explain-why-this-graph-and-the-graph-in-problem-2-suggests-that-using-log-scale-is-preferable-if-fitting-simple-linear-regression-is-desired.">a. Explain why this graph and the graph in Problem 2 suggests that using log-scale is preferable if fitting simple linear regression is desired.</h4>
<ol type="1">
<li><strong>Linearization of the relationship:</strong> The log-log plot shows a much more linear relationship between the variables. The dashed lines (OLS fitted line) closely follows the pattern of the data points, whereas in the original scale in problem 2, the relationship likely exhibited curvature or heteroscedasticity.</li>
<li><strong>Reduction of heteroscedasticity:</strong> In the original scale. the variance of y typically increase with x (larger prices have larger variability). Taking logs stabilizes the variance, making the scatter more uniform acrosss the range of x values. Notice how the points are relatively evenly distributed around the fitted line throughout the range.</li>
<li>Better handling of outliers: The log transformation compresses the scale, making extreme values less influential without eliminating them entirely.</li>
<li>Improved residual behavior: The log transformation often makes residuals more normally distributed and homoscedastic, which are key assumptions for linear regression.</li>
</ol>
</section>
<section id="b.-suppose-we-start-with-a-proposed-model" class="level4">
<h4 class="anchored" data-anchor-id="b.-suppose-we-start-with-a-proposed-model">b. Suppose we start with a proposed model</h4>
</section>
<section id="eyxgamma_0xbeta_1" class="level4">
<h4 class="anchored" data-anchor-id="eyxgamma_0xbeta_1"><span class="math display">\[E(y|x)=\gamma_0x^{\beta_1}\]</span></h4>
<p>This is a common model in many areas of study. Examples include allometry (Gould, 1966), where x could represent the size of one body characteristic such as total weight and y represents some other body characteristic, such as brain weight, psychophysics (Stevens, 1966), in which x is a physical stimulus and y is a psychological response to it, or in economics, where x could represent inputs and y outputs, where this relationship is often called a Cobb-Douglas production function (Greene, 2003).</p>
</section>
<section id="if-we-take-the-logs-of-both-sides-of-the-last-equation-we-get" class="level4">
<h4 class="anchored" data-anchor-id="if-we-take-the-logs-of-both-sides-of-the-last-equation-we-get">If we take the logs of both sides of the last equation, we get</h4>
</section>
<section id="logeyxloggamma_0beta_1logx" class="level4">
<h4 class="anchored" data-anchor-id="logeyxloggamma_0beta_1logx"><span class="math display">\[\log(E(y|x))=\log(\gamma_0)+\beta_1\log(x)\]</span></h4>
</section>
<section id="if-we-approximate-logeyxapprox-elogyx-and-write-beta_0loggamma_0-to-the-extent-that-the-logarithm-of-the-expectation-equals-the-expectation-of-the-logarithm-we-have" class="level4">
<h4 class="anchored" data-anchor-id="if-we-approximate-logeyxapprox-elogyx-and-write-beta_0loggamma_0-to-the-extent-that-the-logarithm-of-the-expectation-equals-the-expectation-of-the-logarithm-we-have">If we approximate <span class="math inline">\(\log(E(y|x))\approx E(\log(y)|x)\)</span>, and write <span class="math inline">\(\beta_0=\log(\gamma_0)\)</span>, to the extent that the logarithm of the expectation equals the expectation of the logarithm, we have</h4>
</section>
<section id="elogyxbeta_0beta_1logx" class="level4">
<h4 class="anchored" data-anchor-id="elogyxbeta_0beta_1logx"><span class="math display">\[E(\log(y)|x)=\beta_0+\beta_1\log(x)\]</span></h4>
</section>
<section id="give-an-interpretation-of-beta_0-and-beta_1-in-this-setting-assuming-beta_10." class="level4">
<h4 class="anchored" data-anchor-id="give-an-interpretation-of-beta_0-and-beta_1-in-this-setting-assuming-beta_10.">Give an interpretation of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> in this setting, assuming <span class="math inline">\(\beta_1&gt;0\)</span>.</h4>
<p>&gt;&gt;&gt;</p>
<p>Starting with the power law model:</p>
<p><span class="math display">\[
E(y|x)=γ_0xβ_1
\]</span></p>
<p>After taking logs and making the approximation, we get:</p>
<p><span class="math display">\[
E(log(y)|x)=β_0+β_1log(x)
\]</span></p>
<p>where <span class="math inline">\(\beta_0=\log(\gamma_0)\)</span>.</p>
<p>Interpretation of <span class="math inline">\(\beta_1\)</span> (assuming <span class="math inline">\(\beta_1&gt;0\)</span>):</p>
<p><span class="math inline">\(\beta_1\)</span> represent the elasticity of y with respect to x. Specifically:</p>
<ul>
<li><p><span class="math inline">\(\beta_1\)</span> is the percentage change in y associated with a 1% increase in x</p></li>
<li><p>Mathematically: if x increase by 1%, then y increases by approximately <span class="math inline">\(\beta_1\)</span>%</p></li>
<li><p>This is because: <span class="math inline">\(\frac{d\log(y)}{d\log(x)}=\beta_1\)</span></p></li>
</ul>
<p>For example:</p>
<ul>
<li><p>If <span class="math inline">\(\beta_1=1\)</span>, the relationship is proportional (y=x line): a 1% increase in x leads to a 1% increase in x leads to a 1% increase y</p></li>
<li><p>If <span class="math inline">\(\beta_1=0.5\)</span>, a 1% increase in c leads to a 0.5% increase in y (diminishing returns)</p></li>
<li><p>If <span class="math inline">\(\beta_1=1.5\)</span>, a 1% increase in x leads to 1.5% increase in y (increasing returns)</p></li>
</ul>
<p>Interpretation of <span class="math inline">\(\beta_0\)</span>:</p>
<p><span class="math inline">\(\beta_0=\log(\gamma_0)\)</span>, so <span class="math inline">\(\gamma_0=\exp(\beta_0)\)</span></p>
<ul>
<li><p><span class="math inline">\(\gamma_0\)</span> represents the value of <span class="math inline">\(E(y|x)\)</span> when <span class="math inline">\(x=1\)</span></p></li>
<li><p>In the original power law model: when <span class="math inline">\(x=1\)</span>, <span class="math inline">\(E(y|1)=\gamma_0(1)^{\beta_1}=\gamma_0\)</span></p></li>
<li><p><span class="math inline">\(\beta_0\)</span> is the log of this baseline value</p></li>
</ul>
<p>In the context of your graph (rice prices), if <span class="math inline">\(\beta_1\approx1\)</span> (as suggested by the proximity of the OLS line to the y=x line), this would indicate that rice prices in 2009 and 2003 are roughly proportional - countries with higher prices in 2003 tend to have proportionally higher prices in 2009, maintaining relative price relationships.</p>
</section>
</section>
<section id="problem-4" class="level2">
<h2 class="anchored" data-anchor-id="problem-4">Problem 4</h2>
<p>(Data file: ) This problem continues with the data file described in Problem 2.</p>
<section id="a.-draw-the-plot-of-ybigmac2009-versus-xbigmac2003-the-price-of-a-big-mac-hamburger-in-2009-and-2003.-on-this-plot-draw-1-the-ols-fitted-line-2-the-line-y-x.-identify-the-most-unusual-cases-and-describe-why-they-are-unusual." class="level4">
<h4 class="anchored" data-anchor-id="a.-draw-the-plot-of-ybigmac2009-versus-xbigmac2003-the-price-of-a-big-mac-hamburger-in-2009-and-2003.-on-this-plot-draw-1-the-ols-fitted-line-2-the-line-y-x.-identify-the-most-unusual-cases-and-describe-why-they-are-unusual.">a. Draw the plot of <code>y=bigmac2009</code>{=} versus <code>x=bigmac2003</code>{=}, the price of a Big Mac hamburger in 2009 and 2003. On this plot draw (1) the ols fitted line; (2) the line y= x. Identify the most unusual cases and describe why they are unusual.</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left plot: without labels</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(UBSprices<span class="sc">$</span>bigmac2003, UBSprices<span class="sc">$</span>bigmac2009,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"2003 Big Mac price (minutes of labor)"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"2009 Big Mac price (minutes of labor)"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Big Mac Prices: 2009 vs 2003"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit OLS regression</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(bigmac2009 <span class="sc">~</span> bigmac2003, <span class="at">data =</span> UBSprices)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add OLS fitted line (dashed)</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add y=x line (solid)</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"ols"</span>, <span class="st">"y=x"</span>), </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Right plot: with city labels for unusual cases</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(UBSprices<span class="sc">$</span>bigmac2003, UBSprices<span class="sc">$</span>bigmac2009,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"2003 Big Mac price (minutes of labor)"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"2009 Big Mac price (minutes of labor)"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Big Mac Prices with City Labels"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify unusual cases</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate residuals and leverage</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>fitted_vals <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>std_resid <span class="ot">&lt;-</span> <span class="fu">rstandard</span>(fit)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Find unusual points (large residuals or high leverage)</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>unusual <span class="ot">&lt;-</span> <span class="fu">abs</span>(std_resid) <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">|</span> UBSprices<span class="sc">$</span>bigmac2003 <span class="sc">&gt;</span> <span class="dv">100</span> <span class="sc">|</span> </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>           UBSprices<span class="sc">$</span>bigmac2009 <span class="sc">&gt;</span> <span class="dv">120</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Label unusual cities</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(UBSprices<span class="sc">$</span>bigmac2003[unusual], </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>     UBSprices<span class="sc">$</span>bigmac2009[unusual],</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels =</span> <span class="fu">rownames</span>(UBSprices)[unusual],</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"ols"</span>, <span class="st">"y=x"</span>), </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Regression Summary:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regression Summary:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(fit))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bigmac2009 ~ bigmac2003, data = UBSprices)

Residuals:
    Min      1Q  Median      3Q     Max 
-32.968  -5.258  -2.159   0.187  77.081 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  6.73612    3.84985   1.750   0.0861 .  
bigmac2003   0.77886    0.07975   9.767 2.33e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 18.35 on 52 degrees of freedom
Multiple R-squared:  0.6472,    Adjusted R-squared:  0.6404 
F-statistic: 95.39 on 1 and 52 DF,  p-value: 2.334e-13</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Most Unusual Cities:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Most Unusual Cities:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>unusual_cities <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">City =</span> <span class="fu">rownames</span>(UBSprices)[unusual],</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">BigMac2003 =</span> UBSprices<span class="sc">$</span>bigmac2003[unusual],</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">BigMac2009 =</span> UBSprices<span class="sc">$</span>bigmac2009[unusual],</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Change =</span> UBSprices<span class="sc">$</span>bigmac2009[unusual] <span class="sc">-</span> UBSprices<span class="sc">$</span>bigmac2003[unusual],</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">StdResid =</span> std_resid[unusual]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unusual_cities[<span class="fu">order</span>(<span class="sc">-</span><span class="fu">abs</span>(unusual_cities<span class="sc">$</span>StdResid)),])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>           City BigMac2003 BigMac2009 Change   StdResid
Jakarta Jakarta         67        136     69  4.2774558
Caracas Caracas         76        126     50  3.3541436
Mumbai   Mumbai        112         61    -51 -1.9209983
Nairobi Nairobi        185        158    -27  0.5195285</code></pre>
</div>
</div>
</section>
<section id="b.-give-two-reasons-why-fitting-simple-linear-regression-to-the-figure-in-this-problem-is-not-likely-to-be-appropriate." class="level4">
<h4 class="anchored" data-anchor-id="b.-give-two-reasons-why-fitting-simple-linear-regression-to-the-figure-in-this-problem-is-not-likely-to-be-appropriate.">b. Give two reasons why fitting simple linear regression to the figure in this problem is not likely to be appropriate.</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Residual vs Fitted plot (check for non-constant variance)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitted_vals, residuals,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Residuals vs Fitted Values"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(fitted_vals, residuals), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Scale-Location plot (check for heteroscedasticity)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitted_vals, <span class="fu">sqrt</span>(<span class="fu">abs</span>(std_resid)),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"√|Standardized Residuals|"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Scale-Location Plot"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(fitted_vals, <span class="fu">sqrt</span>(<span class="fu">abs</span>(std_resid))), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Q-Q plot (check for normality)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(std_resid, <span class="at">main =</span> <span class="st">"Normal Q-Q Plot"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(std_resid, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Residuals vs Leverage (check for influential points)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">hatvalues</span>(fit), std_resid,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Leverage"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Standardized Residuals"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Residuals vs Leverage"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-6-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Reason 1: Heteroscedasticity</strong></p>
<ul>
<li><p>The residual vs fitted plot will show that variance increases with fitted values</p></li>
<li><p>This “fanning out” pattern violates the constant variance assumption</p></li>
<li><p>Larger predicted values have larger residual spread</p></li>
</ul>
<p><strong>Reason 2: Influential Outliers</strong></p>
<ul>
<li><p>Several cities with extreme prices heavily influence the regression line</p></li>
<li><p>These outliers may not represent the general pattern</p></li>
<li><p>Q-Q plot and leverage plots identify these influential points</p></li>
</ul>
</section>
<section id="c.-plot-logbigmac2009-versus-log-and-explainbigmac2003-why-this-graph-is-more-sensibly-summarized-with-a-linear-regression." class="level4">
<h4 class="anchored" data-anchor-id="c.-plot-logbigmac2009-versus-log-and-explainbigmac2003-why-this-graph-is-more-sensibly-summarized-with-a-linear-regression.">c.&nbsp;Plot log(<code>bigmac2009</code>{=}) versus log() and explain(<code>bigmac2003</code>{=}) why this graph is more sensibly summarized with a linear regression.</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate log transformations (removing any non-positive values)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>valid_data <span class="ot">&lt;-</span> UBSprices<span class="sc">$</span>bigmac2003 <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> UBSprices<span class="sc">$</span>bigmac2009 <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>log_bigmac2003 <span class="ot">&lt;-</span> <span class="fu">log</span>(UBSprices<span class="sc">$</span>bigmac2003[valid_data])</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>log_bigmac2009 <span class="ot">&lt;-</span> <span class="fu">log</span>(UBSprices<span class="sc">$</span>bigmac2009[valid_data])</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>valid_cities <span class="ot">&lt;-</span> <span class="fu">rownames</span>(UBSprices)[valid_data]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Left plot: log-log without labels</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(log_bigmac2003, log_bigmac2009,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"log(2003 Big Mac price)"</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"log(2009 Big Mac price)"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Log-Log Plot of Big Mac Prices"</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit OLS on log scale</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>fit_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_bigmac2009 <span class="sc">~</span> log_bigmac2003)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit_log, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"ols"</span>, <span class="st">"y=x"</span>), </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Right plot: with residual analysis</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>residuals_log <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit_log)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>fitted_log <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit_log)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitted_log, residuals_log,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted log(2009 price)"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Residuals vs Fitted (Log Scale)"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(fitted_log, residuals_log), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Log-scale regression summary:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Log-scale regression summary:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(fit_log))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log_bigmac2009 ~ log_bigmac2003)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.11379 -0.10663 -0.01378  0.08207  0.89628 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     0.64031    0.22922   2.793  0.00728 ** 
log_bigmac2003  0.80293    0.06709  11.967  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3324 on 52 degrees of freedom
Multiple R-squared:  0.7336,    Adjusted R-squared:  0.7285 
F-statistic: 143.2 on 1 and 52 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Comparison of model fits:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Comparison of model fits:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Original scale R²: %.4f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">summary</span>(fit)<span class="sc">$</span>r.squared))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original scale R²: 0.6472</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Log scale R²: %.4f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">summary</span>(fit_log)<span class="sc">$</span>r.squared))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Log scale R²: 0.7336</code></pre>
</div>
</div>
<p><strong>Reason 1: Linearization</strong></p>
<ul>
<li><p>The log-log relationship is much more linear than the original scale</p></li>
<li><p>Points cluster more evenly around the regression line</p></li>
</ul>
<p><strong>Reason 2: Homoscedasticity</strong></p>
<ul>
<li><p>Residual variance becomes more constant across the range</p></li>
<li><p>The residual plot shows more uniform scatter</p></li>
</ul>
<p><strong>Reason 3: Multiplicative Effects</strong></p>
<ul>
<li><p>The slope in log-log represents <strong>elasticity</strong>: the percentage change in 2009 prices for a 1% change in 2003 prices</p></li>
<li><p>This multiplicative relationship is more natural for economic data</p></li>
<li><p>Prices tend to change proportionally rather than additively</p></li>
</ul>
</section>
<section id="section" class="level4">
<h4 class="anchored" data-anchor-id="section"></h4>
<p>Problem 5</p>
<p><strong>Ft. Collins temperature data</strong> (Data file: ) The data file gives the mean temperature in the of each year, defined as September 1 to November 30, and the mean temperature in the following , defined as December 1 to the end of February in the following calendar year, in degrees Fahrenheit, for Ft. Collins, CO (Colorado Climate Center, 2012). These data cover the time period from 1900 to 2010. The question of interest is: Does the average temperature predict the average temperature?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(alr4)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"ftcollinstemp"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ftcollinstemp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year fall winter
1 1900 50.2   28.5
2 1901 48.1   28.2
3 1902 48.1   24.7
4 1903 49.9   31.4
5 1904 47.8   26.7
6 1905 46.9   29.8</code></pre>
</div>
</div>
<p>a. Draw a scatterplot of the response versus the predictor, and describe any pattern you might see in the plot.</p>
<p>b. Use statistical software to fit the regression of the response on the predictor. Add the fitted line to your graph. Test the slope to be 0 against a two-sided alternative, and summarize your results.</p>
<p>c. Compute or obtain from your computer output the value of the variability in winter explained by fall and explain what this means.</p>
<p>d. Divide the data into 2 time periods, an early period from 1900 to 1989, and a late period from 1990 to 2010. You can do this using the variable year in the data file. Are the results different in the two time periods?</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>