---
title: "TP4"
format: html
editor: visual
---

# TP4 - Generalized Linear Models

## Problem 1

**Mroz’s Data on Women’s Labour-Force Participation**: The data in the data frame `Mroz` in the car package, originally employed by Mroz (1987), were used by Long (1997) to illustrate the method of logistic regression. The variables in the dataset are described in the following table, adapted from Long (and using Long’s variable names). Most of the variables are self-explanatory. The variable `lwg` is the log of the wife’s actual wage if she is working outside the home. For women not working outside the home, Mroz proceeded as follows: He regressed the log-wages of the working women on the other variables, and used the resulting regression equation to predict the wages of those not working outside the home.

• `lfp`: 1 if the wife is in the paid labour force, 0 otherwise

• `k5`: number of children ages 5 and younger

• `k618`: number of children ages 6 to 18

• `age`: wife’s age in years

• `wc`: 1 if wife attended college, 0 otherwise

• `hc`: 1 if husband attended college, 0 otherwise

• `lwg`: log of wife’s estimated wage rate

• `inc`: family income excluding wife’s wages, \$1000s

Following Long, perform a logistic regression of `lfp` on the other variables. Briefly (i.e., in a paragraph) summarize the results of this regression. Offer two concrete interpretations of the coefficient of `inc` in the logistic regression.

```{r}
# Load required packages
if(!require(car)) install.packages("car")
library(car)
data(Mroz)
str(Mroz)
summary(Mroz)
```

```{r}
# Perform logistic regression of lfp on all other variables
logit_model <- glm(lfp ~ k5 + k618 + age + wc + hc + lwg + inc, 
                   data = Mroz, 
                   family = binomial(link = "logit"))

# Display the summary of the logistic regression
summary(logit_model)
```

The logistic regression analysis reveals several significant predictors of women's labour force participation. The number of young children (k5) has a strong negative effect (p \< 0.001), indicating that each additional child under age 5 substantially reduces the likelihood of labour force participation. Similarly, the wife's age shows a negative association, suggesting that older women in the sample are less likely to work outside the home. In contrast, the log of the wife's estimated wage rate (lwg) has a strong positive effect (p \< 0.001), indicating that women with higher earning potential are more likely to participate in the labour force. Notably, family income excluding the wife's wages (inc) has a significant negative coefficient, suggesting that higher family income reduces the wife's likelihood of working outside the home, possibly due to reduced financial necessity. Educational attainment, measured by college attendance for both wife (wc) and husband (hc), shows positive but varying levels of significance. The number of older children (k618) appears to have a weaker effect on labour force participation compared to younger children.

```{r}
# Calculate odds ratios and confidence intervals
odds_ratios <- exp(coef(logit_model))
conf_intervals <- exp(confint(logit_model))

# Combine results
results <- cbind(Coefficient = coef(logit_model),
                 OddsRatio = odds_ratios,
                 conf_intervals)
print(results)

# Specific interpretations for 'inc' coefficient
inc_coef <- coef(logit_model)["inc"]
inc_odds_ratio <- exp(inc_coef)

cat("\n=== Interpretations of 'inc' coefficient ===\n")
cat("Coefficient:", inc_coef, "\n")
cat("Odds Ratio:", inc_odds_ratio, "\n")
```

-   The 95% confidence interval \[0.9503, 0.9814\] **does not include 1. 0**

-   This confirms the effect is **statistically significant** (p \< 0.001)

-   We can be confident that higher family income genuinely reduces wives' labour force participation

```{r}
# Interpretation 1: Change in log-odds
cat("\nInterpretation 1 (Log-odds):\n")
cat("For each $1,000 increase in family income (excluding wife's wages),\n")
cat("the log-odds of the wife participating in the labour force changes by", 
    round(inc_coef, 4), "\n")
```

**Interpretation 1: Log-Odds Scale (Additive Effect)**

For each **\$1,000 increase** in family income excluding the wife's wages, the **log-odds** of the wife participating in the labour force **decrease by 0.0344 units**, holding all other variables constant.

**More concretely:** Consider two otherwise identical women (same age, education, number of children, etc.). If Woman A's family has an income of \$20,000 (excluding her potential wages) and Woman B's family has an income of \$30,000, then Woman B's log-odds of working are **0.344 units lower** than Woman A's (0.0344 × 10 = 0.344).

This negative relationship suggests that as household income from other sources (primarily husband's earnings) increases, wives become less likely to seek paid employment, consistent with the economic theory of the "income effect" - when the family has sufficient financial resources, there's less economic necessity for the wife to work outside the home.

```{r}
# Interpretation 2: Percentage change in odds
percent_change <- (inc_odds_ratio - 1) * 100
cat("\nInterpretation 2 (Odds):\n")
cat("For each $1,000 increase in family income (excluding wife's wages),\n")
cat("the odds of the wife participating in the labour force are multiplied by", 
    round(inc_odds_ratio, 4), "\n")
cat("This represents approximately a", round(percent_change, 2), 
    "% change in the odds.\n")
```

**Interpretation 2: Odds Ratio Scale (Multiplicative Effect)**

For each **\$1,000 increase** in family income excluding the wife's wages, the **odds** of the wife participating in the labour force are **multiplied by 0.966** (or reduced by approximately 3.4%), holding all other variables constant.

**More concretely:** Consider the same two women from above. Woman B (with family income \$10,000 higher) has odds of labour force participation that are **0.966¹⁰ = 0.708** (or about **71%**) of Woman A's odds. In other words, the higher family income results in approximately a **29% reduction** in the odds of working.

**Practical example with probabilities:** Suppose Woman A (lower income) has a 0.60 probability of working, which corresponds to odds of 0.60/(1-0.60) = 1.5. Woman B (income \$10,000 higher) would have odds of 1.5 × 0.708 = 1.062, corresponding to a probability of 1.062/(1+1.062) = 0.515 or about **51.5%**. Thus, the \$10,000 income difference translates to about an **8.5 percentage point reduction** in the probability of labour force participation.

```{r}
# Model diagnostics
cat("\n=== Model Fit Statistics ===\n")
cat("Null Deviance:", logit_model$null.deviance, "on", 
    logit_model$df.null, "degrees of freedom\n")
cat("Residual Deviance:", logit_model$deviance, "on", 
    logit_model$df.residual, "degrees of freedom\n")
cat("AIC:", AIC(logit_model), "\n")

# Pseudo R-squared (McFadden's R-squared)
pseudo_r2 <- 1 - (logit_model$deviance / logit_model$null.deviance)
cat("McFadden's Pseudo R-squared:", round(pseudo_r2, 4), "\n")
```

## Problem 2

**Powers and Xie’s Data on High-School Graduation**: Employing a sample of 1643 men between the ages of 20 and 24 from the U. S. National Longitudinal Survey of Youth, Powers and Xie (2000) investigate the relationship between high-school graduation and parents’ education, race, family income, number of siblings, family structure, and a test of academic ability. The data set, in the file `Powers.txt` on the course web site, contains the following variables (using Powers and Xie’s variable names):

• `hsgrad`: whether the respondent was graduated from high school by 1985 (`Yes` or `No`)

• `nonwhite`: whether the respondent is black or Hispanic (`Yes` or `No`)

• `mhs`: whether the respondent’s mother is a high-school graduate (`Yes` or `No`)

• `fhs`: whether the respondent’s father is a high-school graduate (`Yes` or `No`)

• `income`: Family income in 1979 (in \$1000s) adjusted for family size

• `asvab`: standardized score on the Armed Services Vocational Aptitude Battery test

• `nsibs`: number of siblings

• `intact`: whether the respondent lived with both biological parents at age 14 (`Yes` or `No`)

The data file also contains respondent ID numbers, which are not contiguous.

```{r}
# Load required libraries
library(tidyverse)
library(car)        # For likelihood ratio tests
library(broom)      # For tidy model outputs

# Read the data
# Assuming the file is space-delimited with header
powers_data <- read.table("Powers.txt", header = TRUE)

# Inspect the data structure
str(powers_data)
head(powers_data)
summary(powers_data)
```

a\. Following Powers and Xie perform a logistic regression of `hsgrad` on the other variables in the data set. Compute a likelihood-ratio test of the omnibus null hypothesis that none of the explanatory variables influences high-school graduation. Then construct 95-percent confidence intervals for the coefficients of the seven explanatory variables. What conclusions can you draw from these results? Finally, offer two brief, but concrete, interpretations of each of the estimated coefficients of income and intact.

b\. The logistic regression in the previous problem assumes that the partial relationship between the log-odds of high-school graduation and number of siblings is linear. Test for nonlinearity by fitting a model that treats `nsibs` as a factor, performing an appropriate likelihood-ratio test. In the course of working this problem, you should discover two errors in the data. Deal with the errors in a reasonable manner. Does the result of the test change?
